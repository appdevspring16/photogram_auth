<div class="page-header">
  <h1>
    Photos
    <a href="/photos/new" class="btn btn-lg btn-success">New Photo</a>
  </h1>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <a href="/photos/new" class="btn btn-default btn-block">
        <i class="fa fa-plus"></i>
      </a>
    </div>
  </div>

      <hr>

      <% @photos.each do |photo| %>
      <div class="row">
        <div class="col-md-8 col-md-offset-2">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title"><%= photo.user.username %> <small><%= time_ago_in_words(photo.created_at) %> ago </small></h3>
            </div>
            <div class="panel-body">
              <a href="/photos/<%= photo.id %>">
              <img src="<%= photo.image %>" class="img-responsive" alt="Responsive image">
              </a>

              <p></p>

              <p><% if photo.likes.pluck(:user_id).include?(current_user.id) == true %>
                 <form action="/delete_like/<%= photo.likes.where({:user_id => current_user.id}).pluck(:id)[0] %>">
                   <button class="btn btn-link">
                     <i class="fa fa-heart"></i>
                   </button>
                <% else %>
                 <form action="/create_like" method="post">

                <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">
                <input type="hidden" name="photo_id" value="<%= photo.id %>">
                <input type="hidden" name="user_id" value="<%= current_user.id %>">

                <button class="btn btn-link">
                  <i class="fa fa-heart-o"></i>
                </button>
                <% end %>




                <% if photo.fans.count == 0 %> Be the first to like this photo
              </p>

                <% elsif photo.fans.count == 1 %>
                  <% photo.fans.each do |fan| %>
                    <%= fan.username %> likes this
                  <% end %>
               </p>
                  <% else %>
                    <%= photo.fans.pluck(:username).to_sentence %>
                  like this
              </p>
            <% end %>

                  <ul class="media-list">
                   <li class="media">
                     <div class="media-body">
                       <h6 class="media-heading">
                         <a href="/users/<%= photo.user.id %>"><%= photo.user.username %></a><small> <%= time_ago_in_words(photo.created_at) %> ago </small></h6>
                         <p>
                           <%= photo.caption %>
                         </p>
                    </div>
                   </li>

                   <% photo.comments.each do |comment|  %>
                    <li class="media">
                      <div class="media-body">
                        <% if (comment.user.id==current_user.id) %>
                          <h6 class="media-heading">
                            <a href="/users/<%= comment.user.id %>"><%= comment.user.username %></a><small> <%= time_ago_in_words(comment.created_at) %> ago </small> </h6>
                        <% else %>
                          <h6 class="media-heading">
                            <a href="/users/<%= comment.user.id %>"><%= comment.user.username %></a><small> <%= time_ago_in_words(comment.created_at) %> ago </h6></small>
                        <% end %>

                   <p>
                     <%= comment.body %>
                   </p>

                  </div>
                    </li>
                  <% end %>
                   <li class="media">
                     <div class="media-body">
                       <form action="/create_comment">
                         <input type="hidden" name="photo_id" value="<%= photo.id %>">
                         <input type="hidden" name="user_id" value="<%= current_user.id %>">
                         <input type="text" name="body" placeholder="Add a comment..." class="form-control">
                       </form>
                     </div>
                   </li>

                  </ul>
            </div>
          </div>
        </div>
      </div>
      <% end %>

</div>
