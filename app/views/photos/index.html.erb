<div class="row">

  <div class="col-md-8 col-md-offset-2">

    <a href="/photos/new" class="btn btn-default btn-block">
      <i class="fa fa-plus"></i>
    </a>

    <hr>

    <% @photos.each do |photo| %>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          <a href="/users/<%= photo.user_id %>" /><%= photo.user.username %></a> <small><%= time_ago_in_words(photo.created_at) %></small></h3>
        </div>
        <div class="panel-body">
          <a href="/photos/<%= photo.id %>"><img class="img-responsive" src="<%= photo.image %>" /></a>
          <p>
            <% if photo.fans.exists?(id: current_user.id) %>
            <a href="/delete_like/<%= photo.likes.where(user_id: current_user.id).pluck(:id)[0] %>" class="btn btn-link">
              <i class="fa fa-heart"></i>
            </a>
            <% else %>
            <form action="/create_like" method="post" style="display:inline;">
              <!-- Hidden input for authenticity token to protect from forgery -->
              <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

              <!-- input for user_id -->
              <input type="hidden" id="user_id" name="user_id" value="<%= current_user.id %>">

              <!-- input for photo_id -->
              <input type="hidden" id="photo_id" name="photo_id"  value="<%= photo.id %>">

              <button class="btn btn-link">
                <i class="fa fa-heart-o"></i>
              </button>
            </form>
            <% end %>

            <% likes = photo.fans.pluck(:username) %>
            <% if likes.count == 0 %>
            <small class="text-muted">be the first to like this</small>
            <% elsif likes.count == 1 %>
            <%= likes.to_sentence %> likes this
            <% elsif likes.count > 1 %>
            <%= likes.to_sentence %> like this
            <% end %>
          </p>

          <ul class="media-list">
            <% photo.comments.each do |comment| %>
            <li class="media">
              <div class="media-body">
                <h6 class="media-heading"><a href="users/<%= comment.user.id %>"><%= comment.user.username %></a> <small><%= time_ago_in_words(comment.created_at) %></small></h6>
                <%= comment.body %>
              </div>
            </li>
            <% end %>
          </ul>
        </div>
      </div>

      <% end %>

    </div>
  </div>
